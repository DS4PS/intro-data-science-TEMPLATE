<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Reading---Efficient-Use-of-Groups.knit</title>

<script src="Reading---Efficient-Use-of-Groups_files/header-attrs-2.14/header-attrs.js"></script>
<script src="Reading---Efficient-Use-of-Groups_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="Reading---Efficient-Use-of-Groups_files/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="Reading---Efficient-Use-of-Groups_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="Reading---Efficient-Use-of-Groups_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="Reading---Efficient-Use-of-Groups_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="Reading---Efficient-Use-of-Groups_files/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="textbook.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="header">




</div>

<div id="TOC">
<ul>
<li><a href="#efficient-use-of-group-structure"><span
class="toc-section-number">1</span> Efficient Use of Group
Structure</a></li>
</ul>
</div>

<div id="efficient-use-of-group-structure" class="section level1"
number="1">
<h1><span class="header-section-number">1</span> Efficient Use of Group
Structure</h1>
<div id="packages-used-in-this-chapter" class="section level2"
number="1.1">
<h2><span class="header-section-number">1.1</span> Packages Used in this
Chapter</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( pander )</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( dplyr )</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( tidyr )</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( reshape2 )</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( scales )</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( ggplot2 )</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( Lahman )</span></code></pre></div>
</div>
<div id="hypothetical-experimental-data" class="section level2"
number="1.2">
<h2><span class="header-section-number">1.2</span> Hypothetical
Experimental Data</h2>
<p>We will demonstrate some functions using this hypothetical
dataset:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( d ) <span class="sc">%&gt;%</span> pander</span></code></pre></div>
<table style="width:88%;">
<colgroup>
<col width="6%" />
<col width="11%" />
<col width="18%" />
<col width="12%" />
<col width="8%" />
<col width="19%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">id</th>
<th align="center">race</th>
<th align="center">blood.type</th>
<th align="center">gender</th>
<th align="center">age</th>
<th align="center">study.group</th>
<th align="center">speed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">white</td>
<td align="center">B</td>
<td align="center">male</td>
<td align="center">35</td>
<td align="center">treatment</td>
<td align="center">502.8</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">white</td>
<td align="center">A</td>
<td align="center">female</td>
<td align="center">43</td>
<td align="center">treatment</td>
<td align="center">707</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">black</td>
<td align="center">B</td>
<td align="center">female</td>
<td align="center">41</td>
<td align="center">treatment</td>
<td align="center">660.5</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">black</td>
<td align="center">B</td>
<td align="center">female</td>
<td align="center">77</td>
<td align="center">treatment</td>
<td align="center">410.8</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">white</td>
<td align="center">B</td>
<td align="center">female</td>
<td align="center">29</td>
<td align="center">treatment</td>
<td align="center">535.9</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">black</td>
<td align="center">B</td>
<td align="center">female</td>
<td align="center">38</td>
<td align="center">treatment</td>
<td align="center">576.9</td>
</tr>
</tbody>
</table>
</div>
<div id="group-structure" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Group Structure</h2>
<p>The two most important skills as you first learn a data programming
language are:</p>
<ol style="list-style-type: decimal">
<li>Translating English phrases into computer code using logical
statements<br />
</li>
<li>Organizing your data into groups</li>
</ol>
<p>This lecture focuses on efficiently splitting your data into groups,
and then analyzing your data by group.</p>
<div id="what-are-groups" class="section level3" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> What Are
Groups?</h3>
<p>A group represents a set of elements with identical characteristics -
mice all belong to one group and elephants belong to another. Easy
enough, right?</p>
<p>In data analysis, it is a little more complicated because a group is
defined by a set of features. Each group still represents a set of
elements with identical characteristics, but when we have multiple
features there is a unique group for each combination of features.</p>
<p>The simple way to think about this is that the cross-tab of features
generates a grid (table), and each cell represents a unique group:</p>
<p><img src="Reading---Efficient-Use-of-Groups_files/figure-html/unnamed-chunk-6-1.png" width="288" /></p>
<p>We might be interested in simple groups (treatment cases versus
control cases) or complex groups (does the treatment effect women and
men differently?).</p>
<p>In previous lectures you have learned to identify a group with a
logical statement and analyze that group discretely.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>( speed[ study.group <span class="sc">==</span> <span class="st">&quot;treatment&quot;</span> <span class="sc">&amp;</span> gender<span class="sc">==</span><span class="st">&quot;female&quot;</span> ] )</span></code></pre></div>
<pre><code>## [1] 616.3736</code></pre>
<p>In this lecture you will learn to define a group structure, then
analyze all of your data using that structure.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>( speed, <span class="at">INDEX =</span> <span class="fu">list</span>( study.group, gender ), <span class="at">FUN =</span> mean )</span></code></pre></div>
<table style="width:47%;">
<colgroup>
<col width="22%" />
<col width="12%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">female</th>
<th align="center">male</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>control</strong></td>
<td align="center">464.6</td>
<td align="center">356.6</td>
</tr>
<tr class="even">
<td align="center"><strong>treatment</strong></td>
<td align="center">616.4</td>
<td align="center">518.3</td>
</tr>
</tbody>
</table>
</div>
<div id="main-take-away" class="section level3" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Main Take-Away</h3>
<p>R has been designed to do efficient data analysis by defining a group
structure, then quickly applying a function to all unique members.</p>
<p><img src="figures/group_plus_function.png" width="300"></p>
<p>The base R packages do this with a set of functions in the
<strong>apply()</strong> family. The <strong>tapply()</strong> function
allows you to specify an outcome to analyze and a group, then ask for
results from a function.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>( <span class="at">X=</span>speed, <span class="at">INDEX=</span><span class="fu">list</span>( study.group, gender ), <span class="at">FUN=</span>mean ) </span></code></pre></div>
<table style="width:47%;">
<colgroup>
<col width="22%" />
<col width="12%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">female</th>
<th align="center">male</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>control</strong></td>
<td align="center">464.6</td>
<td align="center">356.6</td>
</tr>
<tr class="even">
<td align="center"><strong>treatment</strong></td>
<td align="center">616.4</td>
<td align="center">518.3</td>
</tr>
</tbody>
</table>
<p>The <strong>dplyr</strong> package makes this process easier using
some simple verbs and the “pipe” operator.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dat  <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>( study.group, gender )  <span class="sc">%&gt;%</span>  <span class="fu">summarize</span>( <span class="at">ave.speed =</span> <span class="fu">mean</span>(speed) )</span></code></pre></div>
<p><code>summarise()</code> has grouped output by ‘study.group’. You can
override using the <code>.groups</code> argument.</p>
<table style="width:49%;">
<colgroup>
<col width="19%" />
<col width="12%" />
<col width="16%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">study.group</th>
<th align="center">gender</th>
<th align="center">ave.speed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">control</td>
<td align="center">male</td>
<td align="center">356.6</td>
</tr>
<tr class="even">
<td align="center">control</td>
<td align="center">female</td>
<td align="center">464.6</td>
</tr>
<tr class="odd">
<td align="center">treatment</td>
<td align="center">male</td>
<td align="center">518.3</td>
</tr>
<tr class="even">
<td align="center">treatment</td>
<td align="center">female</td>
<td align="center">616.4</td>
</tr>
</tbody>
</table>
</div>
<div id="example" class="section level3" number="1.3.3">
<h3><span class="header-section-number">1.3.3</span> Example</h3>
<p>Let’s think about a study looking at reading speed. The treatment is
a workshop that teaches some speed-reading techniques. In this study we
have data on:</p>
<ul>
<li>gender (male, female)</li>
<li>race (black, white, asian)</li>
<li>blood.type (A, B)</li>
<li>age (from 18 to 93)</li>
</ul>
<p>Examining descriptive statistics we can see that reading speed varies
by gender and the treatment group, but not by race or blood type:</p>
<p><img src="Reading---Efficient-Use-of-Groups_files/figure-html/unnamed-chunk-15-1.png" width="768" /></p>
<p>The question is, how many unique groups can we create with these four
factors?</p>
<p>Each individual factor contains a small number of levels (only 2 or 3
in this case), which makes the group structure look deceptively simple
at first glance. When we start to examine combinations of factors we see
that group structure can get complicated pretty quickly.</p>
<p>If we look at gender alone, we have two levels: male and female. So
we have two groups. If we look at our study groups alone we have two
groups: treatment and control.</p>
<p>If we look at gender and the study groups together, we now have a 2 x
2 grid, or four unique groups.</p>
<p>If the race factor has three levels, how many unique groups will we
have considering the study design, gender, and race together?</p>
<p><img src="Reading---Efficient-Use-of-Groups_files/figure-html/unnamed-chunk-16-1.png" width="768" /></p>
<p>We can calculate the size of the grid by multiplying number of levels
for each factor. We see here we have 12 unique groups:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nlevels</span>( gender ) <span class="sc">*</span> <span class="fu">nlevels</span>( study.group ) <span class="sc">*</span> <span class="fu">nlevels</span>( race )</span></code></pre></div>
<pre><code>## [1] 12</code></pre>
<p>If we add blood type, a factor with two levels (A and B), we now have
24 unique groups:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">facet_grid</span>( race <span class="sc">+</span> study.group <span class="sc">~</span> gender <span class="sc">+</span> blood.type) </span></code></pre></div>
<p><img src="Reading---Efficient-Use-of-Groups_files/figure-html/unnamed-chunk-18-1.png" width="768" /></p>
<p>What about age? It is a continuous variable, so it’s a little more
tricky.</p>
<p>We can certainly analyze the relationship between age and speed using
correlation tools.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( age, speed, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, <span class="at">main=</span><span class="st">&quot;Age&quot;</span> )</span></code></pre></div>
<p><img src="Reading---Efficient-Use-of-Groups_files/figure-html/unnamed-chunk-19-1.png" width="768" /></p>
<p>But we can also incorporate this independent variable into a group
structure. We can treat each distinct age as a separate group. The ages
in this study range from 18 to 93, so we have 65 distinct ages
represented.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( <span class="fu">factor</span>(age), speed, <span class="at">las=</span><span class="dv">2</span>, <span class="at">frame.plot=</span>F, <span class="at">outline=</span>F, <span class="at">main=</span><span class="st">&quot;Age&quot;</span>, <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>  )</span></code></pre></div>
<p><img src="Reading---Efficient-Use-of-Groups_files/figure-html/unnamed-chunk-20-1.png" width="768" /></p>
<p>If we think about the overall group structure, then, we have unique
groups defined by gender, race, blood type, and study design, and
another 65 age groups. So in total we now have 24 x 65 = 1,560 groups!
That is getting complicated.</p>
<p>This group design is problematic for two reasons. From a pragmatic
standpoint, we can’t report results from 1,500 groups in a table. From a
more substantive perspective, although we have 1,500 distinct cells in
our grid, many may not include observations that represent the unique
combination of all factors. So this group design is not very
practical.</p>
<p>A similar problem arises if our data includes time. If our data
includes the time of events recorded by hours, days of the week, months,
and years, we can have complicated group structures if we try to analyze
every unique combination.</p>
<p>We can simplify our analysis by thinking about age ranges instead of
ages, or in other words by binning our continuous data. If we split it
into five-year ranges, for example, we have gone from 65 distinct ages
to 12 distinct age groups.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>age.group <span class="ot">&lt;-</span> <span class="fu">cut</span>( age, </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">breaks=</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">20</span>,<span class="at">to=</span><span class="dv">80</span>,<span class="at">by=</span><span class="dv">5</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels=</span><span class="fu">paste</span>( <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">20</span>,<span class="at">to=</span><span class="dv">75</span>,<span class="at">by=</span><span class="dv">5</span>), </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;to&quot;</span>, <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">25</span>,<span class="at">to=</span><span class="dv">80</span>,<span class="at">by=</span><span class="dv">5</span>) ) )</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>group.structure <span class="ot">&lt;-</span> <span class="fu">formula</span>( speed <span class="sc">~</span> age.group )</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>( group.structure, <span class="at">las=</span><span class="dv">2</span>, <span class="at">frame.plot=</span>F, <span class="at">outline=</span>F, <span class="at">main=</span><span class="st">&quot;Age Group&quot;</span>  )</span></code></pre></div>
<p><img src="Reading---Efficient-Use-of-Groups_files/figure-html/unnamed-chunk-21-1.png" width="768" /></p>
<p>We have now simplified our analysis from 1,560 to 288 possible
groups. Combinations of groups will also be easier:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>group.structure <span class="ot">&lt;-</span> <span class="fu">formula</span>( speed <span class="sc">~</span> gender <span class="sc">*</span> age.group )</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>( group.structure, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">las=</span><span class="dv">2</span>, <span class="at">frame.plot=</span>F, <span class="at">outline=</span>F, <span class="at">main=</span><span class="st">&quot;Age Group by Gender&quot;</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;firebrick&quot;</span>,<span class="st">&quot;steelblue&quot;</span>), <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span> )</span></code></pre></div>
<p><img src="Reading---Efficient-Use-of-Groups_files/figure-html/unnamed-chunk-22-1.png" width="768" /></p>
</div>
</div>
<div id="analysis-by-group" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Analysis by
Group</h2>
<p>Let’s demonstrate some analysis of groups using the Lahman package
and some <strong>dplyr</strong> verbs. Let’s do some analysis of player
salaries (<em>Salaries</em> dataset), and start with a simple group
structure - teams in the National League and time.</p>
<ol style="list-style-type: decimal">
<li>Which team has the highest average player salary?</li>
<li>Which team has the most players paid over $5 million a season?</li>
<li>Which team has raised it’s pay the most over the past decade?</li>
</ol>
<p>Let’s start by thinking about group structure. We have teams, and we
have seasons. Teams is stored as a factor, and seasons as a numeric
value, so we can consider group for each by counting levels and unique
values:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nlevels</span>( Salaries<span class="sc">$</span>teamID )</span></code></pre></div>
<pre><code>## [1] 35</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>( <span class="fu">unique</span>( Salaries<span class="sc">$</span>yearID ) )</span></code></pre></div>
<pre><code>## [1] 32</code></pre>
<p>So we can potentially calculate 32 x 46 = 1,472 average player
salaries.</p>
<div id="highest-average-player-salary" class="section level3"
number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> Highest Average
Player Salary</h3>
<p>For our first question, we will select only teams from the National
League. Let’s use the most recent year of data to calculate average
pay.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Salaries <span class="sc">%&gt;%</span> <span class="fu">filter</span>( lgID <span class="sc">==</span> <span class="st">&quot;NL&quot;</span>, yearID <span class="sc">==</span> <span class="dv">2016</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>( teamID) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summarize</span>( <span class="at">Ave_Salary =</span> <span class="fu">mean</span>(salary) )</span></code></pre></div>
<pre><code>## # A tibble: 15 × 2
##    teamID Ave_Salary
##    &lt;fct&gt;       &lt;dbl&gt;
##  1 ARI      3363041.
##  2 ATL      2362010.
##  3 CHN      5312678.
##  4 CIN      3066899.
##  5 COL      3413487 
##  6 LAN      6322525.
##  7 MIA      2761222.
##  8 MIL      2292508.
##  9 NYN      4958857.
## 10 PHI      2033793.
## 11 PIT      3706387.
## 12 SDN      3756475.
## 13 SFN      6890151.
## 14 SLN      4614629.
## 15 WAS      5448179.</code></pre>
<p>Since the salaries are large, they are a little hard to read. Let’s
clean up the table a bit.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>Salaries  <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>( lgID <span class="sc">==</span> <span class="st">&quot;NL&quot;</span>, yearID <span class="sc">==</span> <span class="dv">2016</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>( teamID ) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summarize</span>( <span class="at">Ave_Salary=</span><span class="fu">dollar</span>( <span class="fu">mean</span>(salary,<span class="at">na.rm=</span>T) ) ) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">arrange</span>( <span class="fu">desc</span>(Ave_Salary) ) <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">pander</span>()</span></code></pre></div>
<table style="width:31%;">
<colgroup>
<col width="12%" />
<col width="18%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">teamID</th>
<th align="center">Ave_Salary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">SFN</td>
<td align="center">$6,890,151</td>
</tr>
<tr class="even">
<td align="center">LAN</td>
<td align="center">$6,322,525</td>
</tr>
<tr class="odd">
<td align="center">WAS</td>
<td align="center">$5,448,179</td>
</tr>
<tr class="even">
<td align="center">CHN</td>
<td align="center">$5,312,678</td>
</tr>
<tr class="odd">
<td align="center">NYN</td>
<td align="center">$4,958,857</td>
</tr>
<tr class="even">
<td align="center">SLN</td>
<td align="center">$4,614,629</td>
</tr>
<tr class="odd">
<td align="center">SDN</td>
<td align="center">$3,756,475</td>
</tr>
<tr class="even">
<td align="center">PIT</td>
<td align="center">$3,706,387</td>
</tr>
<tr class="odd">
<td align="center">COL</td>
<td align="center">$3,413,487</td>
</tr>
<tr class="even">
<td align="center">ARI</td>
<td align="center">$3,363,041</td>
</tr>
<tr class="odd">
<td align="center">CIN</td>
<td align="center">$3,066,899</td>
</tr>
<tr class="even">
<td align="center">MIA</td>
<td align="center">$2,761,222</td>
</tr>
<tr class="odd">
<td align="center">ATL</td>
<td align="center">$2,362,010</td>
</tr>
<tr class="even">
<td align="center">MIL</td>
<td align="center">$2,292,508</td>
</tr>
<tr class="odd">
<td align="center">PHI</td>
<td align="center">$2,033,793</td>
</tr>
</tbody>
</table>
</div>
<div id="most-players-paid-over-5-million" class="section level3"
number="1.4.2">
<h3><span class="header-section-number">1.4.2</span> Most Players Paid
Over $5 Million</h3>
<p>This question requires you to utilize a logical statement in order to
translate from the question to code. We need to inspect each salary,
determine whether it is over the $5m threshold, then count all of the
cases. The operation will look something like this:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>( Salaries<span class="sc">$</span>salary <span class="sc">&gt;</span> <span class="dv">5000000</span> )</span></code></pre></div>
<pre><code>## [1] 3175</code></pre>
<p>It gets a little trickier when we want to do the operation
simultaneously across groups. Our team group structure is already
defined, so let’s define our logical vector and count cases that
match:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dat.NL <span class="ot">&lt;-</span> <span class="fu">filter</span>( Salaries, yearID <span class="sc">==</span> <span class="dv">2010</span> <span class="sc">&amp;</span> lgID <span class="sc">==</span> <span class="st">&quot;NL&quot;</span> ) <span class="sc">%&gt;%</span> <span class="fu">droplevels</span>()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>gt<span class="fl">.5</span>m <span class="ot">&lt;-</span> dat.NL<span class="sc">$</span>salary <span class="sc">&gt;</span> <span class="dv">5000000</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>( dat.NL<span class="sc">$</span>teamID, gt<span class="fl">.5</span>m )</span></code></pre></div>
<pre><code>##      gt.5m
##       FALSE TRUE
##   ARI    23    3
##   ATL    21    6
##   CHN    19    8
##   CIN    21    5
##   COL    23    6
##   FLO    23    4
##   HOU    24    4
##   LAN    20    7
##   MIL    25    4
##   NYN    19    9
##   PHI    18   10
##   PIT    27    0
##   SDN    25    1
##   SFN    21    7
##   SLN    19    6
##   WAS    26    4</code></pre>
<p>This solution works, but the table provides too much information. We
can use <strong>dplyr</strong> to simplify and format the table nicely
for our report:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Salaries <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>( yearID <span class="sc">==</span> <span class="dv">2010</span> <span class="sc">&amp;</span> lgID <span class="sc">==</span> <span class="st">&quot;NL&quot;</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>( teamID ) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarise</span>( <span class="at">gt_five_million =</span> <span class="fu">sum</span>( salary <span class="sc">&gt;</span> <span class="dv">5000000</span> ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>( <span class="fu">desc</span>(gt_five_million) ) <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>   pander</span></code></pre></div>
<table style="width:38%;">
<colgroup>
<col width="12%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">teamID</th>
<th align="center">gt_five_million</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">PHI</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="center">NYN</td>
<td align="center">9</td>
</tr>
<tr class="odd">
<td align="center">CHN</td>
<td align="center">8</td>
</tr>
<tr class="even">
<td align="center">LAN</td>
<td align="center">7</td>
</tr>
<tr class="odd">
<td align="center">SFN</td>
<td align="center">7</td>
</tr>
<tr class="even">
<td align="center">ATL</td>
<td align="center">6</td>
</tr>
<tr class="odd">
<td align="center">COL</td>
<td align="center">6</td>
</tr>
<tr class="even">
<td align="center">SLN</td>
<td align="center">6</td>
</tr>
<tr class="odd">
<td align="center">CIN</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">FLO</td>
<td align="center">4</td>
</tr>
<tr class="odd">
<td align="center">HOU</td>
<td align="center">4</td>
</tr>
<tr class="even">
<td align="center">MIL</td>
<td align="center">4</td>
</tr>
<tr class="odd">
<td align="center">WAS</td>
<td align="center">4</td>
</tr>
<tr class="even">
<td align="center">ARI</td>
<td align="center">3</td>
</tr>
<tr class="odd">
<td align="center">SDN</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">PIT</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
</div>
<div id="fielding-positions" class="section level3" number="1.4.3">
<h3><span class="header-section-number">1.4.3</span> Fielding
Positions</h3>
<p>Which fielding position is the highest paid?</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>( Salaries, Fielding ) <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( yearID <span class="sc">==</span> <span class="dv">2016</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>( POS ) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>( <span class="at">Mean_Salary =</span> <span class="fu">dollar</span>( <span class="fu">mean</span>(salary) ) ) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  pander</span></code></pre></div>
<table style="width:28%;">
<colgroup>
<col width="8%" />
<col width="19%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">POS</th>
<th align="center">Mean_Salary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1B</td>
<td align="center">$5,680,014</td>
</tr>
<tr class="even">
<td align="center">2B</td>
<td align="center">$3,092,188</td>
</tr>
<tr class="odd">
<td align="center">3B</td>
<td align="center">$3,812,355</td>
</tr>
<tr class="even">
<td align="center">C</td>
<td align="center">$3,167,962</td>
</tr>
<tr class="odd">
<td align="center">OF</td>
<td align="center">$4,317,165</td>
</tr>
<tr class="even">
<td align="center">P</td>
<td align="center">$4,002,667</td>
</tr>
<tr class="odd">
<td align="center">SS</td>
<td align="center">$2,574,626</td>
</tr>
</tbody>
</table>
</div>
<div id="country-of-birth" class="section level3" number="1.4.4">
<h3><span class="header-section-number">1.4.4</span> Country of
Birth</h3>
<p>Which country has produced the highest paid baseball players?</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>( Salaries, People ) <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( yearID <span class="sc">==</span> <span class="dv">2016</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>( birthCountry ) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>( <span class="at">Mean_Salary =</span> <span class="fu">dollar</span>( <span class="fu">mean</span>(salary) ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  pander</span></code></pre></div>
<table style="width:42%;">
<colgroup>
<col width="20%" />
<col width="20%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">birthCountry</th>
<th align="center">Mean_Salary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Aruba</td>
<td align="center">$650,000</td>
</tr>
<tr class="even">
<td align="center">Australia</td>
<td align="center">$523,400</td>
</tr>
<tr class="odd">
<td align="center">Brazil</td>
<td align="center">$1,548,792</td>
</tr>
<tr class="even">
<td align="center">CAN</td>
<td align="center">$7,854,167</td>
</tr>
<tr class="odd">
<td align="center">Colombia</td>
<td align="center">$3,125,289</td>
</tr>
<tr class="even">
<td align="center">Cuba</td>
<td align="center">$5,787,593</td>
</tr>
<tr class="odd">
<td align="center">Curacao</td>
<td align="center">$5,724,167</td>
</tr>
<tr class="even">
<td align="center">D.R.</td>
<td align="center">$5,045,623</td>
</tr>
<tr class="odd">
<td align="center">Germany</td>
<td align="center">$511,500</td>
</tr>
<tr class="even">
<td align="center">Japan</td>
<td align="center">$8,247,012</td>
</tr>
<tr class="odd">
<td align="center">Mexico</td>
<td align="center">$5,333,671</td>
</tr>
<tr class="even">
<td align="center">Netherlands</td>
<td align="center">$2,425,000</td>
</tr>
<tr class="odd">
<td align="center">Nicaragua</td>
<td align="center">$2,375,000</td>
</tr>
<tr class="even">
<td align="center">P.R.</td>
<td align="center">$3,241,378</td>
</tr>
<tr class="odd">
<td align="center">Panama</td>
<td align="center">$2,946,550</td>
</tr>
<tr class="even">
<td align="center">Saudi Arabia</td>
<td align="center">$522,500</td>
</tr>
<tr class="odd">
<td align="center">South Korea</td>
<td align="center">$5,326,190</td>
</tr>
<tr class="even">
<td align="center">Taiwan</td>
<td align="center">$6,750,000</td>
</tr>
<tr class="odd">
<td align="center">USA</td>
<td align="center">$4,222,249</td>
</tr>
<tr class="even">
<td align="center">V.I.</td>
<td align="center">$507,500</td>
</tr>
<tr class="odd">
<td align="center">Venezuela</td>
<td align="center">$4,521,051</td>
</tr>
</tbody>
</table>
</div>
<div id="pay-raises" class="section level3" number="1.4.5">
<h3><span class="header-section-number">1.4.5</span> Pay Raises</h3>
<p>To examine pay raises, we will now use more than one year of data.
Since the question asks about pay raises over the past decade, we will
filter the last ten years of data.</p>
<p>And since we are looking at patterns over teams and over time, we
need to define a group structure with two variables:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Salaries <span class="sc">%&gt;%</span> <span class="fu">filter</span>( yearID <span class="sc">&gt;</span> <span class="dv">2006</span> <span class="sc">&amp;</span> lgID <span class="sc">==</span> <span class="st">&quot;NL&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>( teamID, yearID ) <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summarize</span>( <span class="at">mean=</span> <span class="fu">dollar</span>(<span class="fu">mean</span>(salary)) ) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">head</span>( <span class="dv">20</span> ) <span class="sc">%&gt;%</span> pander</span></code></pre></div>
<p><code>summarise()</code> has grouped output by ‘teamID’. You can
override using the <code>.groups</code> argument.</p>
<table style="width:43%;">
<colgroup>
<col width="12%" />
<col width="12%" />
<col width="18%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">teamID</th>
<th align="center">yearID</th>
<th align="center">mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">ARI</td>
<td align="center">2007</td>
<td align="center">$1,859,555</td>
</tr>
<tr class="even">
<td align="center">ARI</td>
<td align="center">2008</td>
<td align="center">$2,364,383</td>
</tr>
<tr class="odd">
<td align="center">ARI</td>
<td align="center">2009</td>
<td align="center">$2,812,141</td>
</tr>
<tr class="even">
<td align="center">ARI</td>
<td align="center">2010</td>
<td align="center">$2,335,314</td>
</tr>
<tr class="odd">
<td align="center">ARI</td>
<td align="center">2011</td>
<td align="center">$1,986,660</td>
</tr>
<tr class="even">
<td align="center">ARI</td>
<td align="center">2012</td>
<td align="center">$2,733,512</td>
</tr>
<tr class="odd">
<td align="center">ARI</td>
<td align="center">2013</td>
<td align="center">$3,004,400</td>
</tr>
<tr class="even">
<td align="center">ARI</td>
<td align="center">2014</td>
<td align="center">$3,763,904</td>
</tr>
<tr class="odd">
<td align="center">ARI</td>
<td align="center">2015</td>
<td align="center">$2,132,207</td>
</tr>
<tr class="even">
<td align="center">ARI</td>
<td align="center">2016</td>
<td align="center">$3,363,041</td>
</tr>
<tr class="odd">
<td align="center">ATL</td>
<td align="center">2007</td>
<td align="center">$3,117,530</td>
</tr>
<tr class="even">
<td align="center">ATL</td>
<td align="center">2008</td>
<td align="center">$3,412,189</td>
</tr>
<tr class="odd">
<td align="center">ATL</td>
<td align="center">2009</td>
<td align="center">$3,335,385</td>
</tr>
<tr class="even">
<td align="center">ATL</td>
<td align="center">2010</td>
<td align="center">$3,126,802</td>
</tr>
<tr class="odd">
<td align="center">ATL</td>
<td align="center">2011</td>
<td align="center">$3,346,257</td>
</tr>
<tr class="even">
<td align="center">ATL</td>
<td align="center">2012</td>
<td align="center">$2,856,205</td>
</tr>
<tr class="odd">
<td align="center">ATL</td>
<td align="center">2013</td>
<td align="center">$3,254,501</td>
</tr>
<tr class="even">
<td align="center">ATL</td>
<td align="center">2014</td>
<td align="center">$4,067,042</td>
</tr>
<tr class="odd">
<td align="center">ATL</td>
<td align="center">2015</td>
<td align="center">$2,990,885</td>
</tr>
<tr class="even">
<td align="center">ATL</td>
<td align="center">2016</td>
<td align="center">$2,362,010</td>
</tr>
</tbody>
</table>
<p>This might seem like an odd format. We might expect something that
looks more like our grid structure:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dat.NL <span class="ot">&lt;-</span> <span class="fu">filter</span>( Salaries, yearID <span class="sc">&gt;</span> <span class="dv">2010</span> <span class="sc">&amp;</span> lgID <span class="sc">==</span> <span class="st">&quot;NL&quot;</span> ) <span class="sc">%&gt;%</span> <span class="fu">droplevels</span>()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>( dat.NL<span class="sc">$</span>salary, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">INDEX=</span><span class="fu">list</span>(dat.NL<span class="sc">$</span>teamID, dat.NL<span class="sc">$</span>yearID), </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN=</span>mean, <span class="at">na.rm=</span>T ) <span class="sc">%&gt;%</span> <span class="fu">pander</span>()</span></code></pre></div>
<table style="width:97%;">
<colgroup>
<col width="13%" />
<col width="13%" />
<col width="13%" />
<col width="13%" />
<col width="13%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">2011</th>
<th align="center">2012</th>
<th align="center">2013</th>
<th align="center">2014</th>
<th align="center">2015</th>
<th align="center">2016</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>ARI</strong></td>
<td align="center">1986660</td>
<td align="center">2733512</td>
<td align="center">3004400</td>
<td align="center">3763904</td>
<td align="center">2132207</td>
<td align="center">3363041</td>
</tr>
<tr class="even">
<td align="center"><strong>ATL</strong></td>
<td align="center">3346257</td>
<td align="center">2856205</td>
<td align="center">3254501</td>
<td align="center">4067042</td>
<td align="center">2990885</td>
<td align="center">2362010</td>
</tr>
<tr class="odd">
<td align="center"><strong>CHN</strong></td>
<td align="center">5001893</td>
<td align="center">3392194</td>
<td align="center">3867989</td>
<td align="center">2426759</td>
<td align="center">4138547</td>
<td align="center">5312678</td>
</tr>
<tr class="even">
<td align="center"><strong>CIN</strong></td>
<td align="center">2531571</td>
<td align="center">2935843</td>
<td align="center">4256178</td>
<td align="center">3864911</td>
<td align="center">4187862</td>
<td align="center">3066899</td>
</tr>
<tr class="odd">
<td align="center"><strong>COL</strong></td>
<td align="center">3390310</td>
<td align="center">2692054</td>
<td align="center">2976363</td>
<td align="center">3180117</td>
<td align="center">3827544</td>
<td align="center">3413487</td>
</tr>
<tr class="even">
<td align="center"><strong>FLO</strong></td>
<td align="center">2190154</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center"><strong>HOU</strong></td>
<td align="center">2437724</td>
<td align="center">2332731</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center"><strong>LAN</strong></td>
<td align="center">3472967</td>
<td align="center">3171453</td>
<td align="center">6980069</td>
<td align="center">6781706</td>
<td align="center">7441103</td>
<td align="center">6322525</td>
</tr>
<tr class="odd">
<td align="center"><strong>MIA</strong></td>
<td align="center">NA</td>
<td align="center">4373259</td>
<td align="center">1400079</td>
<td align="center">1549515</td>
<td align="center">2835688</td>
<td align="center">2761222</td>
</tr>
<tr class="even">
<td align="center"><strong>MIL</strong></td>
<td align="center">2849911</td>
<td align="center">3755921</td>
<td align="center">3077881</td>
<td align="center">3748778</td>
<td align="center">3477586</td>
<td align="center">2292508</td>
</tr>
<tr class="odd">
<td align="center"><strong>NYN</strong></td>
<td align="center">4401752</td>
<td align="center">3457555</td>
<td align="center">1648278</td>
<td align="center">3168777</td>
<td align="center">3870667</td>
<td align="center">4958857</td>
</tr>
<tr class="even">
<td align="center"><strong>PHI</strong></td>
<td align="center">5765879</td>
<td align="center">5817965</td>
<td align="center">6533200</td>
<td align="center">5654530</td>
<td align="center">4295885</td>
<td align="center">2033793</td>
</tr>
<tr class="odd">
<td align="center"><strong>PIT</strong></td>
<td align="center">1553345</td>
<td align="center">2248286</td>
<td align="center">2752214</td>
<td align="center">2756357</td>
<td align="center">3065259</td>
<td align="center">3706387</td>
</tr>
<tr class="even">
<td align="center"><strong>SDN</strong></td>
<td align="center">1479650</td>
<td align="center">1973025</td>
<td align="center">2342339</td>
<td align="center">2703061</td>
<td align="center">4555435</td>
<td align="center">3756475</td>
</tr>
<tr class="odd">
<td align="center"><strong>SFN</strong></td>
<td align="center">4377716</td>
<td align="center">3920689</td>
<td align="center">5006441</td>
<td align="center">5839649</td>
<td align="center">6100056</td>
<td align="center">6890151</td>
</tr>
<tr class="even">
<td align="center"><strong>SLN</strong></td>
<td align="center">3904947</td>
<td align="center">3939317</td>
<td align="center">3295004</td>
<td align="center">4310464</td>
<td align="center">4586212</td>
<td align="center">4614629</td>
</tr>
<tr class="odd">
<td align="center"><strong>WAS</strong></td>
<td align="center">2201963</td>
<td align="center">2695171</td>
<td align="center">4548131</td>
<td align="center">4399456</td>
<td align="center">5365085</td>
<td align="center">5448179</td>
</tr>
</tbody>
</table>
<p>Later on we will look at the benefits of “tidy data”, but the basic
idea is that you can “facet” your analysis easily when your groups are
represented as factors instead of arranged as a table. For example, here
is a time series graph that is faceted by teams:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>Salaries <span class="sc">%&gt;%</span> <span class="fu">filter</span>( yearID <span class="sc">&gt;</span> <span class="dv">2000</span> <span class="sc">&amp;</span> lgID <span class="sc">==</span> <span class="st">&quot;AL&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>( teamID, yearID ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summarize</span>( <span class="at">Mean_Player_Salary=</span><span class="fu">mean</span>(salary) ) <span class="ot">-&gt;</span> t1</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>( <span class="at">data=</span>t1, <span class="at">x=</span>yearID, <span class="at">y=</span>Mean_Player_Salary, </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">geom=</span><span class="fu">c</span>(<span class="st">&quot;point&quot;</span>, <span class="st">&quot;smooth&quot;</span>)  ) <span class="sc">+</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">facet_wrap</span>( <span class="sc">~</span> teamID, <span class="at">ncol=</span><span class="dv">5</span> )</span></code></pre></div>
<p><img src="Reading---Efficient-Use-of-Groups_files/figure-html/unnamed-chunk-33-1.png" width="768" /></p>
<p>Now you can quickly see that Detroit is the team that has raised
salaries most aggressively.</p>
<p>If we need to, we can easily convert a tidy dataset into something
that looks like a table using the <strong>spread()</strong>
function:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>Salaries <span class="sc">%&gt;%</span> <span class="fu">filter</span>( yearID <span class="sc">&gt;</span> <span class="dv">2006</span> <span class="sc">&amp;</span> lgID <span class="sc">==</span> <span class="st">&quot;NL&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>( teamID, yearID ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summarize</span>( <span class="at">mean =</span> <span class="fu">dollar</span>(<span class="fu">mean</span>(salary)) ) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">spread</span>( <span class="at">key=</span>yearID, <span class="at">value=</span>mean, <span class="at">sep=</span><span class="st">&quot;_&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">select</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span> ) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>             pander</span></code></pre></div>
<p><code>summarise()</code> has grouped output by ‘teamID’. You can
override using the <code>.groups</code> argument.</p>
<table>
<colgroup>
<col width="11%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">teamID</th>
<th align="center">yearID_2007</th>
<th align="center">yearID_2008</th>
<th align="center">yearID_2009</th>
<th align="center">yearID_2010</th>
<th align="center">yearID_2011</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">ARI</td>
<td align="center">$1,859,555</td>
<td align="center">$2,364,383</td>
<td align="center">$2,812,141</td>
<td align="center">$2,335,314</td>
<td align="center">$1,986,660</td>
</tr>
<tr class="even">
<td align="center">ATL</td>
<td align="center">$3,117,530</td>
<td align="center">$3,412,189</td>
<td align="center">$3,335,385</td>
<td align="center">$3,126,802</td>
<td align="center">$3,346,257</td>
</tr>
<tr class="odd">
<td align="center">CHN</td>
<td align="center">$3,691,494</td>
<td align="center">$4,383,179</td>
<td align="center">$5,392,360</td>
<td align="center">$5,429,963</td>
<td align="center">$5,001,893</td>
</tr>
<tr class="even">
<td align="center">CIN</td>
<td align="center">$2,210,483</td>
<td align="center">$2,647,061</td>
<td align="center">$3,198,196</td>
<td align="center">$2,760,059</td>
<td align="center">$2,531,571</td>
</tr>
<tr class="odd">
<td align="center">COL</td>
<td align="center">$2,078,500</td>
<td align="center">$2,640,596</td>
<td align="center">$2,785,222</td>
<td align="center">$2,904,379</td>
<td align="center">$3,390,310</td>
</tr>
<tr class="even">
<td align="center">FLO</td>
<td align="center">$984,097</td>
<td align="center">$660,955</td>
<td align="center">$1,315,500</td>
<td align="center">$2,112,212</td>
<td align="center">$2,190,154</td>
</tr>
<tr class="odd">
<td align="center">HOU</td>
<td align="center">$3,250,333</td>
<td align="center">$3,293,719</td>
<td align="center">$3,814,682</td>
<td align="center">$3,298,411</td>
<td align="center">$2,437,724</td>
</tr>
<tr class="even">
<td align="center">LAN</td>
<td align="center">$3,739,811</td>
<td align="center">$4,089,260</td>
<td align="center">$4,016,584</td>
<td align="center">$3,531,778</td>
<td align="center">$3,472,967</td>
</tr>
<tr class="odd">
<td align="center">MIL</td>
<td align="center">$2,629,130</td>
<td align="center">$2,790,948</td>
<td align="center">$3,083,942</td>
<td align="center">$2,796,837</td>
<td align="center">$2,849,911</td>
</tr>
<tr class="even">
<td align="center">NYN</td>
<td align="center">$3,841,055</td>
<td align="center">$4,593,113</td>
<td align="center">$5,334,785</td>
<td align="center">$4,800,819</td>
<td align="center">$4,401,752</td>
</tr>
<tr class="odd">
<td align="center">PHI</td>
<td align="center">$2,980,940</td>
<td align="center">$3,495,710</td>
<td align="center">$4,185,335</td>
<td align="center">$5,068,871</td>
<td align="center">$5,765,879</td>
</tr>
<tr class="even">
<td align="center">PIT</td>
<td align="center">$1,427,327</td>
<td align="center">$1,872,684</td>
<td align="center">$1,872,808</td>
<td align="center">$1,294,185</td>
<td align="center">$1,553,345</td>
</tr>
<tr class="odd">
<td align="center">SDN</td>
<td align="center">$2,235,022</td>
<td align="center">$2,376,697</td>
<td align="center">$1,604,952</td>
<td align="center">$1,453,819</td>
<td align="center">$1,479,650</td>
</tr>
<tr class="even">
<td align="center">SFN</td>
<td align="center">$3,469,964</td>
<td align="center">$2,641,190</td>
<td align="center">$2,965,230</td>
<td align="center">$3,522,905</td>
<td align="center">$4,377,716</td>
</tr>
<tr class="odd">
<td align="center">SLN</td>
<td align="center">$3,224,529</td>
<td align="center">$3,018,923</td>
<td align="center">$3,278,830</td>
<td align="center">$3,741,630</td>
<td align="center">$3,904,947</td>
</tr>
<tr class="even">
<td align="center">WAS</td>
<td align="center">$1,319,554</td>
<td align="center">$1,895,207</td>
<td align="center">$2,140,286</td>
<td align="center">$2,046,667</td>
<td align="center">$2,201,963</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>Salaries <span class="sc">%&gt;%</span> <span class="fu">filter</span>( yearID <span class="sc">&gt;</span> <span class="dv">2006</span> <span class="sc">&amp;</span> lgID <span class="sc">==</span> <span class="st">&quot;NL&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>( teamID, yearID ) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summarize</span>( <span class="at">mean =</span> <span class="fu">dollar</span>(<span class="fu">mean</span>(salary)) ) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">spread</span>( <span class="at">key=</span>teamID, <span class="at">value=</span>mean, <span class="at">sep=</span><span class="st">&quot;_&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">select</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>             pander</span></code></pre></div>
<p><code>summarise()</code> has grouped output by ‘teamID’. You can
override using the <code>.groups</code> argument.</p>
<table>
<colgroup>
<col width="12%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">yearID</th>
<th align="center">teamID_ARI</th>
<th align="center">teamID_ATL</th>
<th align="center">teamID_CHN</th>
<th align="center">teamID_CIN</th>
<th align="center">teamID_COL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">2007</td>
<td align="center">$1,859,555</td>
<td align="center">$3,117,530</td>
<td align="center">$3,691,494</td>
<td align="center">$2,210,483</td>
<td align="center">$2,078,500</td>
</tr>
<tr class="even">
<td align="center">2008</td>
<td align="center">$2,364,383</td>
<td align="center">$3,412,189</td>
<td align="center">$4,383,179</td>
<td align="center">$2,647,061</td>
<td align="center">$2,640,596</td>
</tr>
<tr class="odd">
<td align="center">2009</td>
<td align="center">$2,812,141</td>
<td align="center">$3,335,385</td>
<td align="center">$5,392,360</td>
<td align="center">$3,198,196</td>
<td align="center">$2,785,222</td>
</tr>
<tr class="even">
<td align="center">2010</td>
<td align="center">$2,335,314</td>
<td align="center">$3,126,802</td>
<td align="center">$5,429,963</td>
<td align="center">$2,760,059</td>
<td align="center">$2,904,379</td>
</tr>
<tr class="odd">
<td align="center">2011</td>
<td align="center">$1,986,660</td>
<td align="center">$3,346,257</td>
<td align="center">$5,001,893</td>
<td align="center">$2,531,571</td>
<td align="center">$3,390,310</td>
</tr>
<tr class="even">
<td align="center">2012</td>
<td align="center">$2,733,512</td>
<td align="center">$2,856,205</td>
<td align="center">$3,392,194</td>
<td align="center">$2,935,843</td>
<td align="center">$2,692,054</td>
</tr>
<tr class="odd">
<td align="center">2013</td>
<td align="center">$3,004,400</td>
<td align="center">$3,254,501</td>
<td align="center">$3,867,989</td>
<td align="center">$4,256,178</td>
<td align="center">$2,976,363</td>
</tr>
<tr class="even">
<td align="center">2014</td>
<td align="center">$3,763,904</td>
<td align="center">$4,067,042</td>
<td align="center">$2,426,759</td>
<td align="center">$3,864,911</td>
<td align="center">$3,180,117</td>
</tr>
<tr class="odd">
<td align="center">2015</td>
<td align="center">$2,132,207</td>
<td align="center">$2,990,885</td>
<td align="center">$4,138,547</td>
<td align="center">$4,187,862</td>
<td align="center">$3,827,544</td>
</tr>
<tr class="even">
<td align="center">2016</td>
<td align="center">$3,363,041</td>
<td align="center">$2,362,010</td>
<td align="center">$5,312,678</td>
<td align="center">$3,066,899</td>
<td align="center">$3,413,487</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
